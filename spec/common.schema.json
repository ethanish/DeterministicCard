{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "common.schema.json",
  "title": "SDT Common Definitions",
  "$defs": {
    "schema_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Semantic version of the SDT schema. Current spec version: 0.1.0.",
      "examples": ["0.1.0"],
      "default": "0.1.0"
    },
    "id": {
      "type": "string",
      "minLength": 1,
      "description": "Stable identifier for the object."
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable name."
    },
    "domain": {
      "type": "string",
      "enum": ["game", "oss", "learning", "habit", "custom"],
      "description": "Domain category for the template."
    },
    "capture_mode": {
      "type": "string",
      "enum": ["text", "voice", "button", "auto"]
    },
    "field_type": {
      "type": "string",
      "enum": ["number", "string", "boolean", "enum"]
    },
    "condition_type": {
      "type": "string",
      "enum": ["count", "streak", "threshold", "time_window"]
    },
    "effect_type": {
      "type": "string",
      "enum": ["nudge", "reward_candidate", "discount_candidate"]
    },
    "sdt_support": {
      "type": "object",
      "properties": {
        "autonomy": {
          "type": "string",
          "description": "Description of how the template or agent supports user autonomy."
        },
        "competence": {
          "type": "string",
          "description": "Description of how the template or agent supports user competence."
        },
        "relatedness": {
          "type": "string",
          "description": "Description of how the template or agent supports user relatedness."
        }
      }
    },
    "project_id": {
      "type": "string",
      "minLength": 1,
      "description": "Stable identifier for a project."
    },
    "user_id": {
      "type": "string",
      "minLength": 1,
      "description": "Stable identifier for a user."
    },
    "workflow_id": {
      "type": "string",
      "minLength": 1
    },
    "step_id": {
      "type": "string",
      "minLength": 1
    },
    "execution_id": {
      "type": "string",
      "minLength": 1
    },
    "event_id": {
      "type": "string",
      "minLength": 1
    },
    "transaction_id": {
      "type": "string",
      "minLength": 1
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "trigger_type": {
      "type": "string",
      "enum": ["time_interval", "event", "manual", "condition"]
    },
    "action_type": {
      "type": "string",
      "enum": ["capture", "suggest", "analyze", "remind", "custom"]
    },
    "event_type": {
      "type": "string",
      "enum": ["choice_made", "field_changed", "session_end"]
    },
    "credit_transaction_type": {
      "type": "string",
      "enum": ["credit_spend", "credit_grant", "refund"]
    }
  }
}
