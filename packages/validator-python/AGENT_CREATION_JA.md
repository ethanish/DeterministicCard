# エージェント作成ガイド: CLIによる新しいエージェントの作成

## 1. 哲学

### 1.1 自己決定理論（SDT）に基づく設計哲学

このCLIツールは、**自己決定理論（Self-Determination Theory: SDT）**の核心原則に基づいて設計されています。SDTは、人間の内発的動機と成長のための3つの基本的な心理的ニーズを強調します：

- **自律性（Autonomy）**: ユーザーが自分の目標と意味を選択する自由
- **有能感（Competence）**: ユーザーが自分で定義した成長を認識する能力
- **関係性（Relatedness）**: 選択的で強制されない接続と共有

### 1.2 エージェント作成の哲学的意味

エージェントを作成することは、単に技術的なJSONファイルを作成することではありません。それは：

1. **構造の提供、制御ではない**: エージェントはユーザーに構造を提供しますが、その構造の使用方法はユーザーが決定します。
2. **成長のためのツール**: エージェントは、ユーザーが自分の成長を追跡し、反映できるツールです。
3. **選択の自由**: ユーザーはいつでもエージェントを変更または無効化できます。

### 1.3 「エージェントが新しいエージェントを作成する」ことの意味

このCLIを実行してエージェントを作成する際、私たちは：

- **テンプレートベースの一貫性**: 既存のテンプレートを参照することで一貫した構造を維持します。
- **検証による自律性の保証**: スキーマ検証を通じて、ユーザーが正しい構造を選択したことを確認します。
- **拡張可能な設計**: ユーザーは自分のニーズに応じてcapabilitiesを追加または変更できます。

## 2. 正確なTodoチェックリスト

### 2.1 事前準備フェーズ

#### やること（To Do）
- [ ] テンプレートファイルの確認と選択（`template.schema.json`に準拠する必要がある）
- [ ] エージェントの目的と役割を明確に定義する
- [ ] エージェントがサポートするSDT要素を決定する（autonomy、competence、relatedness）
- [ ] 必要なcapabilityタイプを決定する（capture、suggest、remind、analyze、custom）
- [ ] テンプレートのフィールドとエージェントのcapabilities間のマッピングを計画する

#### 完了確認（Done）
- [ ] テンプレートIDの確認完了
- [ ] エージェントIDと名前の決定完了
- [ ] JSONエディタまたはテキストエディタの準備完了

### 2.2 エージェントJSONファイル作成フェーズ

#### やること（To Do）
- [ ] 必須フィールドの記述: `id`、`name`、`template_id`
- [ ] オプションフィールドの記述: `description`
- [ ] `capabilities`配列の記述（各capabilityにはタイプ固有の必須フィールドが含まれる）
- [ ] `sdt_support`オブジェクトの記述（autonomy、competence、relatednessの説明）
- [ ] `enabled`フィールドの設定（デフォルト: true）

#### 完了確認（Done）
- [ ] すべての必須フィールドの記述完了
- [ ] JSON構文エラーがないことを確認
- [ ] テンプレートのフィールドとcapabilityのフィールド参照が一致することを確認

### 2.3 検証フェーズ

#### やること（To Do）
- [ ] CLIコマンドの実行: `sdt-validate agent <agent_file.json>`
- [ ] テンプレートファイルと一緒に検証: `sdt-validate agent <agent_file.json> --template <template_file.json>`
- [ ] 検証エラーの修正（ある場合）
- [ ] 最終検証の通過確認

#### 完了確認（Done）
- [ ] スキーマ検証の通過（"OK"出力の確認）
- [ ] テンプレート参照検証の通過
- [ ] すべてのcapabilityのフィールド参照の有効性確認完了

### 2.4 デプロイと使用フェーズ

#### やること（To Do）
- [ ] エージェントファイルを適切な場所に保存する
- [ ] エージェントを使用するアプリケーションに統合する
- [ ] ユーザーテストとフィードバックの収集
- [ ] 必要に応じてエージェントを修正し、再検証する

#### 完了確認（Done）
- [ ] エージェントファイルのデプロイ完了
- [ ] アプリケーション統合完了
- [ ] 初期テスト完了

## 3. 自己決定理論に沿った設計の詳細説明

### 3.1 自律性（Autonomy）サポート設計

#### 3.1.1 構造的自律性

エージェント設計は、ユーザーに**構造を提供しますが、制御しません**：

```json
{
  "capabilities": [
    {
      "type": "capture",
      "field": "reflection",
      "trigger": "manual"  // ユーザーが直接選択
    }
  ]
}
```

- **トリガーオプション**: `manual`、`on_field_change`、`on_time_interval`、`on_session_end`、`on_condition_met`
- ユーザーは常に`trigger: "manual"`を選択して完全な制御権を持つことができます。
- `enabled: false`に設定すると、エージェントを完全に無効化できます。

#### 3.1.2 選択の自由

- **Capability選択**: ユーザーは必要なcapabilitiesのみを選択してエージェントを構成します。
- **SDTサポート選択**: `sdt_support`オブジェクトでどのSDT要素を強調するかを選択できます。
- **フィールドマッピング**: テンプレートのすべてのフィールドを使用する必要はなく、必要なフィールドのみをcapabilitiesにマッピングします。

#### 3.1.3 検証による自律性の保証

CLIの検証プロセスは：

1. **構造検証**: JSONスキーマへの準拠を確認し、技術的エラーを防ぎます。
2. **参照検証**: テンプレートとの一貫性を確認し、エージェントが意図通りに動作することを保証します。
3. **強制なし**: 検証は「正しい」使用方法を強制せず、構造的一貫性のみを確認します。

### 3.2 有能感（Competence）サポート設計

#### 3.2.1 成長追跡能力

エージェントは、ユーザーが定義した成長を追跡できるように設計されています：

```json
{
  "capabilities": [
    {
      "type": "analyze",
      "field": "session_length",
      "trigger": "on_time_interval",
      "config": {
        "model": "trend_analysis",
        "parameters": {
          "window": "7d"
        }
      }
    }
  ],
  "sdt_support": {
    "competence": "ユーザー定義のセッション長の傾向を分析して成長を可視化します。"
  }
}
```

- **Analyze Capability**: ユーザーデータを分析してパターンと傾向を発見します。
- **ユーザー定義メトリクス**: テンプレートの`metrics`と連携して、ユーザーが定義した成長指標を追跡します。

#### 3.2.2 即座のフィードバック

- **Suggest Capability**: ユーザーの入力に基づいて即座の提案を提供します。
- **Remind Capability**: ユーザーが設定した間隔で成長を思い出させます。

#### 3.2.3 透明な動作

- **明確な説明**: `description`と`sdt_support`を通じて、エージェントの動作方法を明確に説明します。
- **予測可能性**: トリガーとconfigを通じて、ユーザーはエージェントの動作タイミングと方法を予測できます。

### 3.3 関係性（Relatedness）サポート設計

#### 3.3.1 選択的共有

```json
{
  "sdt_support": {
    "relatedness": "ユーザーは選択的に振り返りを共有できます。これは強制されません。"
  }
}
```

- **オプションフィールド**: テンプレートの`optional: true`フィールドを活用して、共有を選択的にします。
- **手動トリガー**: 共有関連のcapabilitiesは`trigger: "manual"`を使用して、ユーザーに完全な制御権を与えます。

#### 3.3.2 非強制的な接続

- エージェントは関係性を**サポート**しますが、**強制しません**。
- `sdt_support.relatedness`は説明のみで、必須機能ではありません。

### 3.4 統合設計原則

#### 3.4.1 テンプレートベースの一貫性

エージェントは必ずテンプレートを参照します（`template_id`）。これにより：

- **構造的一貫性**: 同じテンプレートを使用する複数のエージェント間の一貫性を維持
- **拡張性**: テンプレートを変更すると、そのテンプレートを使用するすべてのエージェントに影響を与える可能性がある
- **検証可能性**: テンプレートとエージェント間の参照を検証してエラーを防ぐ

#### 3.4.2 Capabilitiesのモジュール化

各capabilityは独立して動作し、ユーザーは必要なもののみを選択できます：

- **Capture**: データ収集
- **Suggest**: 提案の提供
- **Remind**: 通知の提供
- **Analyze**: 分析の実行
- **Custom**: ユーザー定義機能

#### 3.4.3 検証プロセスのSDT整合

CLIの検証プロセス自体がSDT原則に従います：

1. **自律性**: 検証は「正しい」使用方法を強制せず、構造的一貫性のみを確認します。
2. **有能感**: 検証により、エージェントがユーザーの意図通りに動作することを保証します。
3. **関係性**: テンプレート参照検証により、他のコンポーネントとの一貫性を保証します。

### 3.5 実用的な使用例

#### 例1: ゲーム成長追跡エージェント

```json
{
  "id": "game-growth-agent-001",
  "name": "ゲームセッション分析エージェント",
  "template_id": "game-growth-basic",
  "description": "プレイヤーのゲームセッションを分析し、成長傾向を提供します。",
  "capabilities": [
    {
      "type": "capture",
      "field": "session_length",
      "trigger": "on_session_end"
    },
    {
      "type": "analyze",
      "field": "session_length",
      "trigger": "on_time_interval",
      "config": {
        "model": "trend",
        "parameters": {
          "interval": "7d"
        }
      }
    },
    {
      "type": "suggest",
      "field": "difficulty",
      "trigger": "on_field_change",
      "config": {
        "max_suggestions": 3
      }
    }
  ],
  "sdt_support": {
    "autonomy": "プレイヤーは難易度とセッション長を自由に選択します。",
    "competence": "セッション長の傾向を分析して、プレイヤーの持続性の向上を示します。",
    "relatedness": "プレイヤーは選択的に振り返りを共有できます。"
  },
  "enabled": true
}
```

このエージェントは：
- **自律性**: プレイヤーが難易度を選択し、振り返りはオプションです。
- **有能感**: セッション長の傾向分析を通じて成長を示します。
- **関係性**: 選択的な振り返り共有をサポートします。

#### 例2: 学習追跡エージェント

```json
{
  "id": "learning-agent-001",
  "name": "学習進捗リマインダーエージェント",
  "template_id": "learning-basic",
  "description": "学習者の進捗を追跡し、定期的なリマインダーを提供します。",
  "capabilities": [
    {
      "type": "remind",
      "field": "study_time",
      "trigger": "on_time_interval",
      "config": {
        "interval": "1d",
        "message": "今日の学習時間を記録してください。"
      }
    },
    {
      "type": "capture",
      "field": "study_time",
      "trigger": "manual"
    }
  ],
  "sdt_support": {
    "autonomy": "学習者はいつ、どれだけ学習するかを自由に選択します。",
    "competence": "学習時間の追跡を通じて、継続的な学習習慣の形成をサポートします。",
    "relatedness": "学習者は学習グループと選択的に進捗を共有できます。"
  },
  "enabled": true
}
```

## 4. CLI使用法の要約

### 4.1 基本検証

```bash
sdt-validate agent my_agent.json
```

### 4.2 テンプレートと一緒に検証（推奨）

```bash
sdt-validate agent my_agent.json --template my_template.json
```

### 4.3 カスタムスペックディレクトリの使用

```bash
sdt-validate agent my_agent.json --spec-dir /path/to/spec
```

### 4.4 検証成功時

```
OK
```

### 4.5 検証失敗時

特定の問題を含む詳細なエラーメッセージが出力されます。それらを修正して再度検証してください。

## 5. 結論

このCLIを使用してエージェントを作成するプロセスは、単純な技術的タスクではありません。それは、自己決定理論の原則に従って、ユーザーの自律性、有能感、関係性をサポートするツールを作成することです。

検証プロセスを通じて構造的一貫性を保証しながらも、ユーザーは自分のニーズに応じてエージェントを自由に構成し、変更できます。これが「構造の提供、制御ではない」という設計哲学の実装です。
